# Lecture 6: Threads [Part-B]
## Thread Abstraction
#### Terms:
- **Thread** - A single execution sequence that repeats a separately scheduled task.
- **Single Execution Sequence** - A thread executes a sequence of intructions:
  - Assignments, conditionals, loops, proceedures, etc.
- **Seperately Schedulable Task**
  - The OS can run, resume, suspend any task at any point in time.
  
## Heaps and Stacks
#### Terms:
- **Thread Local Variables** - variables that track parts of the heap that are in use, available, etc.

#### Concepts:
- For performance reasons, heaps may _internally subdivide_ their space into per-thread regions.
  - This is so threads can allocate their resources at the same time _without interfering_ with other threads.
  - Cache hits may improve when allocating an objects used by the same thread.
- New memory allocations (malloc | calloc) can take memory from _shared heap_ iff the local heap is used up.
- The size of the threads stack must be large enough to accommodate the _deepest nesting level_ needed in the threads lifetime.
- Kernal Threads
  - Stacks are allocated on the physical memory.
  - The nesting depth for kernals tend to be small.
  - Buffers and data structures are allocated on the heap and never as procedure local variables.
- User level stacks are allocated in virtual memory.
- Catching program errors:
  - Most OS will trigger and error if a programs stack grows too large to quickly.

## Thread Creation
#### Terms:
- **Thread Class** - A class that can be extended to use its methods tailored towards threads.
  - E.g Thread.sleep, Thread.*.
- **Runnable** - When a class implements Runnable it must have a run() method.

![alt-text](https://raw.githubusercontent.com/jarretflack/cs455Studying/master/Midterm/images/L6-Using-Thread-Class.png)


#### Concepts:
- Thread _name_:
  - Default is Thread-N, where N is a unique number;
- Thread _group_:
  - A thread is assigned to the thread group of the thread that calls the constructor.
- _Runnable target_:
  - This is the list of commands the thread will execute.
  - Default: run() of the thread itself
- _Stack size_:
  - Store temporary varaibles during method execution.
  - Platform-dependant.
- The main() method is where the first _thread starts executing_.
  - _Subsequent threads_ start executing with the run() method.

## Thread Lifecycle
### Terms:
- **Lifecycle**
  - Creating
  - Running
  - Terminating

![alt-text](https://raw.githubusercontent.com/jarretflack/cs455Studying/master/Midterm/images/L6-Deprecated-Methods.png)

- **Thead Object** - The object that represent the running thread.

### Concepts:
- A thread exists once it is constructed, but is _not executing_. The thread is in a _waiting_ state.  
  - In a waiting state, other threads may _interact_ with the thread object.
  - Object state may be changed via method interaction.
- We call the _start()_ method when we are ready to begin execution of a thread.
  - Start() call some internal house-keeping, then calls the _run()_ method.
- When the start() method returns, _two threads_ are running in parallel
  - The original thread that called start() and the new thread that is executing run().
- When a thread begins execution it is said to be _alive_.
  - This can be checked with the isAlive() method.
    - True means that the thread is _executing_ the run() method.
    - False means that the thread may _not be started yet_ or may have _terminated_
- When a thread is executing it only uses the run() method.
  - This method may _execute forever_ or _call several other methods_.
- A thread is said to be completed when the run() method _finishes_.
- The run() method finishes when:
  - It hits a return statement.
  - It executes the last statement in the run() method.
  - When it _throws an exeption_ or fails to catch an exception thrown _to it_.
- Terminating a thread:
  - The only way for a thread to terminate is finishing its run() method
  - Don't use the stop() method, it has a _race condition_.
- More about run() method:
  - This method may throw an _unchecked_ exception, but cannot throw a _checked_ exception.
  - This method can be stoped by:
    - Throwing an _unchecked exception_.
    - Failing to catch an _unchecked exception_ that was given to the run method.
- Thread suspension:
  - A thread may suspend itself by calling the sleep() method.
- When using wait()/notify() mechanisms, the thread must have this coded into the object.
  - This _is not_ a generic suspend/resume that is imposed by a another thread.
- As long as an active object holds a reference to a thread it may access the thread.
  - If all objects holding a reference to a thread leave scope, the thread is _garbage collected_.
- Determining if work is completed:
  - This can be done using the join() method.
    - This method _Blocks_ until the thread has completed.
    - It returns immediatly if the thread has already completed the task.
  - Don't use join() to poll if a thread is done.

## Stoping A Thread
### Terms:
- **Delays** - These are inevitable while waiting for threads to terminate
### Concepts:

![alt-text](https://raw.githubusercontent.com/jarretflack/cs455Studying/master/Midterm/images/L6-Stoping_Threads.png)

- It is a good idea to use a flag in order to stop a thread.


  
  
